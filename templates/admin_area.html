{% extends 'base.html' %}

{% block content %}

{% if user.is_superuser %}

<div class="container">

    <p>
        {% with users.count as total_users %}
        Total number of users at Review |Â Alliance:
        {{ total_users }}
        {% endwith %}
    </p>

    <p>
        {% with post.count as total_reviews %}
        Total number of reviews :
        {{ total_reviews }}
        {% endwith %}
    </p>

    <p>
        {% with unapproved.count as total_unapproved %}
        Number of reviews that need your approval:
        {{ total_unapproved }}
        {% endwith %}


    </p>


    <p>
        {% with comment.count as total_comments %}
        Number of comments:
        {{ total_comments }}
        {% endwith %}
    </p>





    <h1 class="headline mt-4">Admin Area</h1>
    <p>
        <h2 class="intro-text">Welcome {{ user.first_name }}!</h2>
    </p>
    <hr />

    <!-- Reviews Table -->

    <div class="mt-3">
        <h5 class="mt-4">Reviews Area</h5>
        <div class="table-responsive-md">
            <table class="table table-bordered">
                <thead class="bg-dark text-light text-center align-middle">
                    <tr>
                        <th>#</th>
                        <th>Featured Image</th>
                        <th>Date Published</th>
                        <th>Title</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Status</th>
                        <th>Approved</th>
                        <th>Action</th>

                    </tr>
                </thead>
                <tbody>
                    {% for review in post %}
                    <tr class="align-middle">
                        <td>{{ review.id }}</td>
                        <td class="text-center">
                            {% if 'default_image' in review.featured_image.url %}
                            <img class="image-table-admin rounded"
                                src="https://res.cloudinary.com/worldofmarcus/image/upload/v1664265037/mukybfipd5kv6etq9nmo.png">
                            {% else %}
                            <img class="image-table-admin rounded" src="{{ review.featured_image.url }}">
                            {% endif %}
                        </td>
                        <td>{{ review.date_created_on }}</td>
                        <td>{{ review.title }}</td>
                        <td>{{ review.author.first_name }}</td>
                        <td>{{ review.author.last_name }}</td>
                        <td>
                            {% if review.status == 1 %}
                            Published
                            {% else %}
                            Draft
                            {% endif %}
                        </td>
                        <td class="text-center">{% if review.approved == True %}
                            <i class="fa-solid fa-check"></i>
                            {% else %}
                            <i class="fa-sharp fa-solid fa-xmark"></i>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <form method="post">
                                {% csrf_token %}
                                {% if review.status == 1 %}
                                <button type="submit"
                                    class="btn btn-outline-secondary btn-sm mt-1 mb-1">Unpublish</button>
                                {% else %}
                                <button type="submit"
                                    class="btn btn-outline-secondary btn-sm mt-1 mb-1">Publish</button>
                                {% endif %}
                                {% if review.approved == True %}
                                <button type="submit"
                                    class="btn btn-outline-secondary btn-sm mt-1 mb-1">Unapprove</button>
                                {% else %}
                                <button type="submit" class="btn btn-outline-secondary btn-sm mt-1 mb-1"
                                    data-url="{% url 'delete_review' review.slug %}">Approve</button>
                                {% endif %}

                                {% if review.status == 1 %}
                                <a href="{% url 'review_details' review.slug %}"
                                    class="btn btn-outline-secondary btn-sm ">View
                                </a>
                                {% endif %}
                                <a href="{% url 'delete_review' review.slug %}" class="btn btn-danger btn-sm ">Delete
                                </a>

                            </form>




                        </td>
                    </tr>
                </tbody>
                {% endfor %}
            </table>
        </div>

    </div>

    <hr />
    <!-- Comments Table -->
    <div class=" mt-3">
        <h5 class="mt-4">Comment Area</h5>
        <div class="table-responsive-md">
            <table class="table table-bordered">
                <thead class="bg-dark text-light text-center align-middle">
                    <tr>
                        <th>#</th>
                        <th>Date Published</th>
                        <th>Name</th>
                        <th>User</th>
                        <th>Comment</th>
                        <th>Approved</th>
                        <th>Action</th>

                    </tr>
                </thead>
                <tbody>
                    {% for comment in comment %}
                    <tr class="align-middle">
                        <td>{{ comment.id }}</td>

                        <td>{{ comment.date_created_on }}</td>
                        <td>{{ comment.name }}</td>
                        <td>{{ user.name }}</td>
                        <td>{{ comment.body }}</td>
                        <td class="text-center">{% if comment.approved == True %}
                            <i class="fa-solid fa-check"></i>
                            {% else %}
                            <i class="fa-sharp fa-solid fa-xmark"></i>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <form method="post">
                                {% csrf_token %}
                                {% if comment.approved == True %}
                                <button type="submit"
                                    class="btn btn-outline-secondary btn-sm mt-1 mb-1">Unapprove</button>
                                {% else %}
                                <button type="submit"
                                    class="btn btn-outline-secondary btn-sm mt-1 mb-1">Approve</button>
                                {% endif %}
                                <button type="submit" class="btn btn-danger btn-sm mt-1 mb-1">Delete</button>
                            </form>
                        </td>
                    </tr>
                </tbody>
                {% endfor %}
            </table>
        </div>

    </div>

    {% else%}
    <p class=" author card-text">You are not allowed here!</p>
    {% endif %}
</div>


{% endblock content %}